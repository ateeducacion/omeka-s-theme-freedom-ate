<?php
$urlHelper = $this->plugin('url');
$translate = $this->plugin('translate');
$hyperlink = $this->plugin('hyperlink');
if ($user):
    $url = $urlHelper('admin');
?>
<div id="user-bar" class="main-header__user-bar">
    <a href="<?php echo $url; ?>" class="user-account-link" title="Admin Panel">
        <span class="material-symbols-outlined" style="font-size:35px;">account_circle</span>
    </a>
    <div class="user-bar__info">
        <span class="user-bar__name"><?php echo $hyperlink($user->getName(), $url); ?></span>
        <a href="<?php echo $this->url('logout', [], true); ?>" class="button user-bar__logout" id="logout-button"><?php echo $this->translate('Logout'); ?></a>
<script>
document.getElementById('logout-button').addEventListener('click', function(e) {
    e.preventDefault();
    var logoutUrl = this.href;
    fetch(logoutUrl, {
        method: 'GET',
        credentials: 'same-origin'
    }).then(function(response) {
        // Recargar siempre - si el logout tuvo éxito, el usuario verá la página sin login
        // Si falló, seguirá logueado y puede intentar de nuevo
        window.location.reload();
    }).catch(function() {
        // En caso de error de red, redirigir al logout tradicional
        window.location.href = logoutUrl;
    });
});
</script>
    </div>
</div>

<?php endif; ?>
